<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ChuMore 餐廳會員註冊系統">
<title>ChuMore - 餐廳註冊 - 步驟一</title>

<!-- External Resources -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
	rel="stylesheet">

<style>
/* 原有的樣式保持不變 */
:root {
	--primary: #F2994A;
	--primary-dark: #e58b3d;
	--primary-light: rgba(242, 153, 74, 0.1);
	--secondary: #092C4C;
	--error: #EB5757;
	--success: #27AE60;
	--gray-1: #333333;
	--gray-2: #4F4F4F;
	--gray-3: #828282;
	--gray-4: #BDBDBD;
}

body {
	background-color: #f8f9fa;
	min-height: 100vh;
	font-family: 'Microsoft JhengHei', sans-serif;
}

.navbar {
	background-color: white;
	box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
	padding: 1rem 0;
}

.navbar-brand {
	color: var(--primary);
	font-size: 1.5rem;
	font-weight: 700;
}

.form-container {
	max-width: 560px;
	margin: 2rem auto;
	padding: 2.5rem;
	background: white;
	border-radius: 12px;
	box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.progress {
	height: 4px;
	background-color: var(--gray-4);
	border-radius: 2px;
	overflow: hidden;
}

.progress-bar {
	background-color: var(--primary);
	transition: width 0.6s ease;
}

.form-label {
	color: var(--gray-2);
	font-weight: 500;
	font-size: 0.875rem;
	margin-bottom: 0.5rem;
}

.form-control {
	padding: 0.75rem 1rem;
	border: 1.5px solid var(--gray-4);
	border-radius: 8px;
	font-size: 0.875rem;
	transition: all 0.3s ease;
}

.form-control:focus {
	border-color: var(--primary);
	box-shadow: 0 0 0 3px var(--primary-light);
}

.input-group .btn {
	border-start-end-radius: 8px;
	border-end-end-radius: 8px;
	padding: 0.75rem;
}

.btn-primary {
	background-color: var(--primary);
	border: none;
	padding: 0.875rem;
	font-weight: 500;
	border-radius: 8px;
	transition: all 0.3s ease;
}

.btn-primary:hover {
	background-color: var(--primary-dark);
	transform: translateY(-1px);
	box-shadow: 0 4px 12px rgba(242, 153, 74, 0.2);
}

.step-title {
	color: var(--gray-1);
	font-size: 1.5rem;
	font-weight: 600;
	margin-bottom: 1.5rem;
	padding-bottom: 1rem;
	border-bottom: 1px solid var(--gray-4);
}

.invalid-feedback {
	font-size: 0.75rem;
	color: var(--error);
	margin-top: 0.25rem;
}

.password-requirements {
	font-size: 0.75rem;
	color: var(--gray-3);
	margin-top: 0.5rem;
}

.alert {
	border-radius: 8px;
	border: none;
}

.alert ul {
	padding-left: 1.5rem;
	margin-bottom: 0;
}

@media ( max-width : 576px) {
	.form-container {
		margin: 1rem;
		padding: 1.5rem;
	}
}
</style>
</head>
<body>
	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-light">
		<div class="container">
			<a class="navbar-brand" href="#">ChuMore</a>
		</div>
	</nav>

	<!-- Container -->
	<main class="container">
		<div class="form-container">
			<!-- Progress Bar -->
			<div class="progress mb-4">
				<div class="progress-bar" role="progressbar" style="width: 50%"
					aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
			</div>

			<h2 class="step-title">步驟 1：基本資料</h2>

			<!-- Alert Messages -->
			<div th:if="${errorMessage}"
				class="alert alert-danger alert-dismissible fade show mb-4"
				role="alert">
				<i class="bi bi-exclamation-circle me-2"></i> <span
					th:text="${errorMessage}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"
					aria-label="Close"></button>
			</div>

			<!-- Registration Form -->
			<form th:action="@{/auth/register/restregister1}" method="post"
				th:object="${restRegisterRequest}" class="needs-validation"
				novalidate>

				<input type="hidden" th:name="${_csrf.parameterName}"
					th:value="${_csrf.token}" />

				<!-- Form Errors -->
				<div th:if="${#fields.hasErrors('*')}"
					class="alert alert-danger mb-4">
					<ul>
						<li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
					</ul>
				</div>

				<!-- Form Fields -->
				<div class="mb-3">
					<label for="merchantName" class="form-label">負責人姓名</label> <input
						type="text" class="form-control" id="merchantName"
						th:field="*{merchantName}" required
						th:classappend="${#fields.hasErrors('merchantName')} ? 'is-invalid' : ''"
						placeholder="請輸入負責人姓名">
					<div class="invalid-feedback"
						th:if="${#fields.hasErrors('merchantName')}"
						th:errors="*{merchantName}">請輸入負責人姓名</div>
				</div>

				<div class="mb-3">
					<label for="merchantEmail" class="form-label">電子郵件</label> <input
						type="email" class="form-control" id="merchantEmail"
						th:field="*{merchantEmail}" required
						th:classappend="${#fields.hasErrors('merchantEmail')} ? 'is-invalid' : ''"
						placeholder="請輸入電子郵件">
					<div class="invalid-feedback"
						th:if="${#fields.hasErrors('merchantEmail')}"
						th:errors="*{merchantEmail}">請輸入有效的電子郵件地址</div>
				</div>
				
				

				<div class="mb-4">
					<label for="merchantPassword" class="form-label">密碼</label>
					<div class="input-group">
						<input type="password" class="form-control" id="merchantPassword"
							th:field="*{merchantPassword}" required minlength="8"
							th:classappend="${#fields.hasErrors('merchantPassword')} ? 'is-invalid' : ''"
							placeholder="請設定密碼">
						<button type="button"
							class="btn btn-outline-secondary password-toggle"
							data-target="merchantPassword">
							<i class="bi bi-eye"></i>
						</button>
					</div>
					<div class="invalid-feedback"
						th:if="${#fields.hasErrors('merchantPassword')}"
						th:errors="*{merchantPassword}">密碼格式不符合要求</div>
					<div class="password-requirements mt-2">
						<i class="bi bi-info-circle"></i> 密碼長度至少8個字元，需包含大小寫字母及數字
					</div>
				</div>

				<div class="mb-4">
					<label for="confirmPassword" class="form-label">確認密碼</label>
					<div class="input-group">
						<input type="password" class="form-control" id="confirmPassword"
							th:field="*{confirmPassword}" required
							th:classappend="${#fields.hasErrors('confirmPassword')} ? 'is-invalid' : ''"
							placeholder="請再次輸入密碼">
						<button type="button" class="btn btn-outline-secondary"
							onclick="togglePassword('confirmPassword', 'toggleConfirmIcon')">
							<i class="bi bi-eye" id="toggleConfirmIcon"></i>
						</button>
					</div>
					<div class="invalid-feedback"
						th:if="${#fields.hasErrors('confirmPassword')}"
						th:errors="*{confirmPassword}">請再次輸入密碼</div>
				</div>

				<div class="d-grid gap-2">
					<button type="submit" class="btn btn-primary">下一步</button>
					<a th:href="@{/auth/register}" class="btn btn-outline-secondary">返回</a>
				</div>
			</form>
		</div>
		</div>

		<script th:inline="javascript">
        // Form Validation
        (() => {
            'use strict';
            const forms = document.querySelectorAll('.needs-validation');
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!validateForm()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();

        // Password Toggle Function
        document.querySelectorAll('.password-toggle').forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.getAttribute('data-target');
            const passwordField = document.getElementById(targetId);
            const icon = button.querySelector('i');

            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                icon.classList.replace('bi-eye', 'bi-eye-slash');
            } else {
                passwordField.type = 'password';
                icon.classList.replace('bi-eye-slash', 'bi-eye');
            }
        });
    });

        // Password Validation
       function validatePasswordFormat(passwordField) {
    const password = passwordField.value;
    const requirements = [
        { test: /[A-Z]/, message: '需要至少一個大寫字母' },
        { test: /[a-z]/, message: '需要至少一個小寫字母' },
        { test: /\d/, message: '需要至少一個數字' },
        { test: /.{8,}/, message: '長度至少為 8 個字元' },
    ];
    for (const req of requirements) {
        if (!req.test.test(password)) {
            passwordField.setCustomValidity(req.message);
            return false;
        }
    }
    passwordField.setCustomValidity('');
    return true;
}

function validateConfirmPassword() {
    const password = document.getElementById('merchantPassword').value;
    const confirmPassword = document.getElementById('confirmPassword');
    if (password !== confirmPassword.value) {
        confirmPassword.setCustomValidity('密碼與確認密碼不符');
        return false;
    }
    confirmPassword.setCustomValidity('');
    return true;
}

document.getElementById('merchantPassword').addEventListener('input', (e) => validatePasswordFormat(e.target));
document.getElementById('confirmPassword').addEventListener('input', validateConfirmPassword);

    </script>

		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>