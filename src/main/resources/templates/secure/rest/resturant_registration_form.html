<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>餐廳上架申請</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .preview-image {
            max-width: 200px;
            max-height: 200px;
            margin: 10px;
            object-fit: cover;
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="mb-4 text-center">餐廳上架申請</h1>
        <form id="restaurantForm" novalidate enctype="multipart/form-data">
            <!-- 第一行：餐廳名稱和連絡電話 -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="restaurantName" class="form-label">餐廳名稱</label>
                    <input type="text" class="form-control" id="restaurantName" required>
                    <div class="invalid-feedback">請輸入餐廳名稱</div>
                </div>
                <div class="col-md-6">
                    <label for="contactPhone" class="form-label">連絡電話</label>
                    <input type="tel" class="form-control" id="contactPhone" pattern="[0-9]{10}" required>
                    <div class="invalid-feedback">請輸入有效的10位數電話號碼</div>
                </div>
            </div>

            <!-- 第二行：縣市、鄉鎮市區和地址 -->
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="city" class="form-label">縣市</label>
                    <select class="form-select" id="city" required>
                        <option value="">選擇縣市</option>
                        <option value="taipei">台北市</option>
                        <option value="newtaipei">新北市</option>
                        <!-- 可以繼續添加其他縣市 -->
                    </select>
                    <div class="invalid-feedback">請選擇縣市</div>
                </div>
                <div class="col-md-4">
                    <label for="district" class="form-label">鄉鎮市區</label>
                    <select class="form-select" id="district" required>
                        <option value="">選擇鄉鎮市區</option>
                        <!-- 這裡的選項會根據選擇的縣市動態更新 -->
                    </select>
                    <div class="invalid-feedback">請選擇鄉鎮市區</div>
                </div>
                <div class="col-md-4">
                    <label for="address" class="form-label">地址</label>
                    <input type="text" class="form-control" id="address" required>
                    <div class="invalid-feedback">請輸入地址</div>
                </div>
            </div>

            <!-- 第三行：餐廳簡介 -->
            <div class="mb-3">
                <label for="restaurantDescription" class="form-label">餐廳簡介</label>
                <textarea class="form-control" id="restaurantDescription" rows="4" required></textarea>
                <div class="invalid-feedback">請輸入餐廳簡介</div>
            </div>

            <!-- 第四行：餐廳環境圖片 -->
            <div class="mb-3">
                <label for="environmentImages" class="form-label">餐廳環境圖片</label>
                <input type="file" class="form-control" id="environmentImages" multiple accept="image/*">
                <div class="image-preview-container" id="environmentImagesPreview"></div>
            </div>

            <!-- 第五行：菜單圖片 -->
            <div class="mb-3">
                <label for="menuImages" class="form-label">菜單圖片</label>
                <input type="file" class="form-control" id="menuImages" multiple accept="image/*">
                <div class="image-preview-container" id="menuImagesPreview"></div>
            </div>

            <!-- 第六行：預設桌數 -->
            <div class="mb-3">
                <div class="row">
                    <div class="col-md-4">
                        <label for="smallTables" class="form-label">1~2人桌數量</label>
                        <input type="number" class="form-control" id="smallTables" min="0" value="0">
                    </div>
                    <div class="col-md-4">
                        <label for="mediumTables" class="form-label">3~4人桌數量</label>
                        <input type="number" class="form-control" id="mediumTables" min="0" value="0">
                    </div>
                    <div class="col-md-4">
                        <label for="largeTables" class="form-label">5~8人桌數量</label>
                        <input type="number" class="form-control" id="largeTables" min="0" value="0">
                    </div>
                </div>
            </div>

            <!-- 提交按鈕 -->
            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">提交申請</button>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    $(document).ready(function() {
        // 圖片預覽功能
        function previewImages(inputElement, previewContainer) {
            $(previewContainer).empty();
            const files = inputElement.files;
            
            for (let i = 0; i < files.length; i++) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imgElement = $('<img>')
                        .addClass('preview-image')
                        .attr('src', e.target.result);
                    
                    $(previewContainer).append(imgElement);
                }
                
                reader.readAsDataURL(files[i]);
            }
        }

        // 綁定圖片預覽事件
        $('#environmentImages').change(function() {
            previewImages(this, '#environmentImagesPreview');
        });

        $('#menuImages').change(function() {
            previewImages(this, '#menuImagesPreview');
        });
        
        // 表單提交處理
        $('#restaurantForm').on('submit', function(event) {
            event.preventDefault();
            event.stopPropagation();

            const form = $(this);
            
            if (this.checkValidity()) {
                const formData = new FormData();

                // 基本字段
                formData.append('restaurantName', $('#restaurantName').val());
                formData.append('contactPhone', $('#contactPhone').val());
                formData.append('city', $('#city').val());
                formData.append('district', $('#district').val());
                formData.append('address', $('#address').val());
                formData.append('restaurantDescription', $('#restaurantDescription').val());
                formData.append('smallTables', $('#smallTables').val());
                formData.append('mediumTables', $('#mediumTables').val());
                formData.append('largeTables', $('#largeTables').val());

                // 環境圖片文件
                const environmentImages = $('#environmentImages')[0].files;
                for (let i = 0; i < environmentImages.length; i++) {
                    formData.append('environmentImages', environmentImages[i]);
                }

                // 菜單圖片文件
                const menuImages = $('#menuImages')[0].files;
                for (let i = 0; i < menuImages.length; i++) {
                    formData.append('menuImages', menuImages[i]);
                }

                // 使用 AJAX 提交表單
                $.ajax({
                    url: '/api/restaurant/apply',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(response) {
                        console.log('表單提交成功:', response);
                        alert('申請已提交！');
                        form[0].reset();
                        $('.image-preview-container').empty();
                    },
                    error: function(error) {
                        console.error('表單提交失敗:', error);
                        alert('提交失敗，請重試！');
                    }
                });
            }

            form.addClass('was-validated');
        });

        // 縣市選擇改變時更新鄉鎮市區選項
        $('#city').change(function() {
            const city = $(this).val();
            const district = $('#district');
            district.empty().append('<option value="">選擇鄉鎮市區</option>');

            // 這裡可以根據選擇的縣市添加對應的鄉鎮市區選項
            if (city === 'taipei') {
                const taipeiDistricts = ['中正區', '大同區', '中山區', '松山區', '大安區', '萬華區', '信義區', '士林區', '北投區', '內湖區', '南港區', '文山區'];
                taipeiDistricts.forEach(d => {
                    district.append(`<option value="${d}">${d}</option>`);
                });
            }
            // 可以繼續添加其他縣市的鄉鎮市區
        });
    });
    </script>
</body>
</html>