<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>餐廳結帳確認頁</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    
    <head th:insert="~{/included.html}"></head>
    <!-- <head th:insert="~{/header_merchant.html}"></head> -->
    <!-- <head th:insert="~{/sidebar_merchent.html}"></head> -->
    <link href="/static/css/restCheckout.css" rel="stylesheet">
    <link th:href="@{/css/restCheckout.css}" rel="stylesheet">
</head>
<body>
    <!-- <main class="main"> -->
        <div class="checkout-container">
            <!-- Order Info -->
            <div class="order-info">
                <div class="row">
                    <div class="col-6">
                        <i class="fas fa-chair me-2"></i>
                        <span th:text="${orderMaster.orderTable.tableNumber}">內用座位C</span>
                    </div>
                    <div class="col-6">
                        <i class="fas fa-clock me-2"></i>
                        <span>入座時間：</span><span th:text="${#temporals.format(orderMaster.servedDatetime, 'yyyy/MM/dd HH:mm')}">2024/11/06 17:00</span>
                    </div>
                </div>
            </div>

            <th:block th:each="orderItemVO : ${orderMaster.orderItems}">
                <div class="p-4">
                    <div class="order-time">
                        第<span th:text="${orderItemVOStat.count}">一</span>次點餐　<span th:text="${orderItemVO.formatCreatedDatetime}">17:03</span>
                    </div>

                    <!-- Table Headers -->
                    <div class="row table-header">
                        <div class="col-6">品項</div>
                        <div class="col-2 text-end">單價</div>
                        <div class="col-2 text-end">數量</div>
                        <div class="col-2 text-end">小計</div>
                    </div>

                    <th:block th:each="orderLineItemVO : ${orderItemVO.orderLineItem}">
                        <div class="order_line_item">
                            <div class="row">
                                <div class="col-6" th:text="${orderLineItemVO.product.productName}">
                                    起司牛肉堡
                                </div>
                                <div class="col-2 text-end">$<span th:text="${#numbers.formatDecimal(orderLineItemVO.price, 1, 0)}">200</span></div>
                                <div class="col-2 text-end" th:text="${orderLineItemVO.quantity}">2</div>
                                <div class="col-2 text-end" th:text="'$' + ${#numbers.formatDecimal(orderLineItemVO.price * orderLineItemVO.quantity, 1, 0)}">$400</div>
                            </div>
                        </div>
                    </th:block>

                    <div class="order_item_options" th:switch="${#strings.isEmpty(orderItemVO.memo)}">
                        備註：
                        <span th:case="${false}" th:text="${orderItemVO.memo}"></span>
                        <span th:case="${true}">無</span>
                    </div>
                </div>
            </th:block>


            <!-- Member Verification Section -->
            <div class="discount-section">
                <form class="member-section justify-content-end" id="memberPhoneForm">
                    <div id="memberStatus" class="member-status"></div>
                    <label class="mb-0">會員驗證：</label>
                    <input type="tel" class="form-control" style="max-width: 200px;" 
                        placeholder="請輸入手機號碼" id="memberPhoneNumber" name="memberPhoneNumber">
                    <button type="button" class="btn btn-primary" id="verifyPhoneNumberBtn">驗證</button>
                </form>
            </div>

            <!-- Total Section -->
            <div class="total-section">
                <div class="total-row">
                    <span>小計</span>
                    <span>$ 1,000</span>
                </div>
                <div class="total-row">
                    <span>會員折扣</span>
                    <span id="discountAmount">$ 0</span>
                </div>
                <div class="total-row">
                    <span><strong>總金額</strong></span>
                    <span><strong id="finalTotal">$ 1,000</strong></span>
                </div>
            </div>

            <!-- Checkout Button -->
            <button class="checkout-btn btn">
                $ 1,000 結帳
            </button>
        </div>
    <!-- </main> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script> -->
    <script th:inline="javascript">
        window.orderMaster = /*[[${orderMaster}]]*/ {};
        // console.log(orderMaster);
    </script>
    <script th:src="@{/js/restOrderCheckout.js}"></script>
    <script src="/static/js/restOrderCheckout.js"></script>
    <script>
        // $(document).ready(function() {
        //      // 模擬會員資料庫
        //      const members = {
        //          '0912345678': { name: '王小明', discount: 50 },
        //          '0923456789': { name: '李小華', discount: 100 }
        //      };
           
        //      $('#verifyMember').click(function() {
        //          const phone = $('#phoneNumber').val();
        //          const statusDiv = $('#memberStatus');
                
        //          // 清除之前的狀態
        //          statusDiv.removeClass('success error');
                
        //          // 驗證手機號碼格式
        //          if (!/^09\d{8}$/.test(phone)) {
        //              statusDiv.text('請輸入有效的手機號碼').addClass('error');
        //              resetDiscount();
        //              return;
        //          }
                
        //          // 檢查是否為會員
        //          const member = members[phone];
        //          if (member) {
        //              statusDiv.text(`會員驗證成功：${member.name}`).addClass('success');
        //              updateDiscount(member.discount);
        //          } else {
        //              statusDiv.text('查無會員資料').addClass('error');
        //              resetDiscount();
        //          }
        //      });
            
        //      function updateDiscount(discount) {
        //          const subtotal = 1000;
        //          const total = subtotal - discount;
                
        //          $('#discountAmount').text('$ ' + discount);
        //          $('#finalTotal').text('$ ' + total);
        //          $('.checkout-btn').text('$ ' + total + ' 結帳');
        //      }
            
        //      function resetDiscount() {
        //          updateDiscount(0);
        //      }

        //      // 結帳按鈕點擊事件
        //      $('.checkout-btn').click(function() {
        //          alert('處理結帳...');
        //      });
        //  });
    </script>
</body>
</html>
